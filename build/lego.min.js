!function(t){var i={extend:function(t,i,e){t.prototype=Object.create(i.prototype),t.superClass=i,e&&this.merge(t.prototype,e)},merge:function(t,i){for(var e in i)t[e]=i[e]},to2d:function(t){var i=1e3,e=i/(i-t.z);return{x:275+t.x*e,y:200+t.y*e}}};t.lego=i}(this),function(){var t={create:function(t,i,e){return[t||0,i||0,e||0]},dot:function(t,i){return t[0]*i[0]+t[1]*i[1]+t[2]*i[2]},cross:function(t,i){return[t[1]*i[2]-t[2]*i[1],t[2]*i[0]-t[0]*i[2],t[0]*i[1]-t[1]*i[0]]},scale:function(t,i){return[t[0]*i,t[1]*i,t[2]*i]},plus:function(t,i){return[t[0]+i[0],t[1]+i[1],t[2]+i[2]]},minus:function(t,i){return[t[0]-i[0],t[1]-i[1],t[2]-i[2]]},normal:function(t){var i=1/t.getLength();return[t[0]*i,t[1]*i,t[2]*i]},getLength:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2])},getLengthSquared:function(t){return t[0]*t[0]+t[1]*t[1]+t[2]*t[2]},distance:function(t,i){return this.getLength(t[0]-i[0],t[1]-i[1],t[2]-i[2])},distanceSquared:function(t,i){return this.getLengthSquared(t[0]-i[0],t[1]-i[1],t[2]-i[2])}};lego.Vector3=t}(this),function(){var t=lego.Vector3,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e={create:function(){return i.concat()},clone:function(t){return t.concat()},setIdentity:function(t){this.set(t,i)},set:function(t,i){for(var e=0;16>e;e++)t[e]=i[e]},concat:function(t,i){var e,n,s,r,o,a,h,c;for(n=t,s=t,r=i,n===r&&(r=this.clone(n)),e=0;4>e;e++)o=s[e],a=s[e+4],h=s[e+8],c=s[e+12],n[e]=o*r[0]+a*r[1]+h*r[2]+c*r[3],n[e+4]=o*r[4]+a*r[5]+h*r[6]+c*r[7],n[e+8]=o*r[8]+a*r[9]+h*r[10]+c*r[11],n[e+12]=o*r[12]+a*r[13]+h*r[14]+c*r[15]},multiplyVector3:function(i,e){var n=t.create();return n[0]=e[0]*i[0]+e[1]*i[4]+e[2]*i[8]+i[12],n[1]=e[0]*i[1]+e[1]*i[5]+e[2]*i[9]+i[13],n[2]=e[0]*i[2]+e[1]*i[6]+e[2]*i[10]+i[14],n},transpose:function(t){var i;i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i},setScale:function(t,i,e,n){t[0]=i,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=e,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=n,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1},scale:function(t,i,e,n){t[0]*=i,t[4]*=e,t[8]*=n,t[1]*=i,t[5]*=e,t[9]*=n,t[2]*=i,t[6]*=e,t[10]*=n,t[3]*=i,t[7]*=e,t[11]*=n},setTranslate:function(t,i,e,n){t[0]=1,t[4]=0,t[8]=0,t[12]=i,t[1]=0,t[5]=1,t[9]=0,t[13]=e,t[2]=0,t[6]=0,t[10]=1,t[14]=n,t[3]=0,t[7]=0,t[11]=0,t[15]=1},translate:function(t,i,e,n){t[12]+=t[0]*i+t[4]*e+t[8]*n,t[13]+=t[1]*i+t[5]*e+t[9]*n,t[14]+=t[2]*i+t[6]*e+t[10]*n,t[15]+=t[3]*i+t[7]*e+t[11]*n},setRotate:function(t,i,e,n,s){var r,o,a,h,c,u,l,v,f,p,d;i=Math.PI*i/180,r=Math.sin(i),o=Math.cos(i),0!==e&&0===n&&0===s?(0>e&&(r=-r),t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=o,t[9]=-r,t[13]=0,t[2]=0,t[6]=r,t[10]=o,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1):0===e&&0!==n&&0===s?(0>n&&(r=-r),t[0]=o,t[4]=0,t[8]=r,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=-r,t[6]=0,t[10]=o,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1):0===e&&0===n&&0!==s?(0>s&&(r=-r),t[0]=o,t[4]=-r,t[8]=0,t[12]=0,t[1]=r,t[5]=o,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1):(a=Math.sqrt(e*e+n*n+s*s),1!==a&&(h=1/a,e*=h,n*=h,s*=h),c=1-o,u=e*n,l=n*s,v=s*e,f=e*r,p=n*r,d=s*r,t[0]=e*e*c+o,t[1]=u*c+d,t[2]=v*c-p,t[3]=0,t[4]=u*c-d,t[5]=n*n*c+o,t[6]=l*c+f,t[7]=0,t[8]=v*c+p,t[9]=l*c-f,t[10]=s*s*c+o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1)},rotate:function(t,i,e,n,s){var r=this.create();this.setRotate(r,i,e,n,s),this.concat(t,r)}};lego.Matrix4=e}(this),function(t){var i=t.lego,e=i.Matrix4,n=(i.Vector3,function(t){this.x=0,this.y=0,this.z=0,this.pivotX=0,this.pivotY=0,this.pivotZ=0,this.scaleX=1,this.scaleY=1,this.scaleZ=1,this.rotationX=0,this.rotationY=0,this.rotationZ=0,this.mat=e.create(),this.alpha=1,this.visible=!0,this.parent=null,this.children=[],i.merge(this,t)});i.merge(n.prototype,{addChild:function(t){t.removeFromParent(),this.children.indexOf(t)<0&&(this.children.push(t),t.parent=this)},removeChild:function(t){var i=this.children.indexOf(t);i>-1&&(t.parent=null,this.children.splice(i,1))},removeFromParent:function(){var t=this.parent;t&&t.removeChild(this)},render:function(t,i){var e=this.children;this.onUpdate&&this.onUpdate(i);for(var n=0,s=e.length;s>n;n++){var r=e[n];r.render(t,i)}t.save(),this._transform(t),this._draw(t),t.restore()},getVector:function(){for(var i=e.create(),n=this.parent;n;){var s=e.create();e.translate(s,n.x,n.y,n.z),e.rotate(s,n.rotationX,1,0,0),e.rotate(s,n.rotationY,0,1,0),e.rotate(s,n.rotationZ,0,0,1),e.scale(s,n.scaleX,n.scaleY,n.scaleZ),e.translate(s,-n.pivotX,-n.pivotY,-n.pivotZ),e.concat(s,i),i=s,n=n.parent}return t.finalMat=i,e.multiplyVector3(i,[this.x,this.y,this.z])},_transform:function(){var t=this.getVector(),e=i.to2d({x:t[0],y:t[1],z:t[2]});this._pos=e},_draw:function(){}}),i.View=n}(this),function(t){var i=t.lego,e=i.View,n=function(t){this.canvas=null,this.ctx=null,this._lastTime=0,e.call(this,t),this._init()};i.extend(n,e,{_init:function(){this.canvas||(this.canvas=document.createElement("canvas"),document.body.appendChild(this.canvas)),this.ctx=this.canvas.getContext("2d"),this.resize(this.width,this.height)},_tick:function(){var t=+new Date,i=this.ctx;i.clearRect(0,0,this.width,this.height),this.render(i,t-this._lastTime),this._lastTime=t},start:function(t){var i=this;this.interval=setInterval(function(){i._tick()},1e3/t),this._lastTime=+new Date,i._tick()},stop:function(){clearInterval(this.interval)},resize:function(t,i){this.width=t,this.height=i,this.canvas.width=t,this.canvas.height=i}}),i.Stage=n}(this),function(t){var i=t.lego,e=i.View,n=function(t){this.points=[],this.views=[],this.pointSize=0,this.lineWidth=1,e.call(this,t),this.init()};i.extend(n,e,{init:function(){for(var t=this,i=0,n=this.points.length;n>i;i++){var s=new e(this.points[i]);this.views.push(s),this.addChild(s),t.pointSize&&(s._draw=function(i){var e=t.pointSize;i.beginPath(),i.arc(this._pos.x,this._pos.y,e,0,2*Math.PI),i.stroke()})}},_render:function(){},_draw:function(t){t.beginPath();var i={x:0,y:0};t.moveTo(this.views[0]._pos.x-i.x,this.views[0]._pos.y-i.y);for(var e=1,n=this.views.length;n>e;e++){var s=this.views[e];s.move?t.moveTo(s._pos.x-i.x,s._pos.y-i.y):t.lineTo(s._pos.x-i.x,s._pos.y-i.y)}t.lineTo(this.views[0]._pos.x-i.x,this.views[0]._pos.y-i.y),t.lineWidth=this.lineWidth,t.stroke()}}),i.Group=n}(this),function(t){var i=t.lego,e=i.Group,n=function(t){this.w=0,this.h=0,this.l=0,e.call(this,t)};i.extend(n,e,{init:function(){var t=this.w,i=this.h,n=this.l;this.points=[{x:0,y:0,z:0},{x:t,y:0,z:0},{x:t,y:i,z:0},{x:0,y:i,z:0},{x:0,y:0,z:0},{x:0,y:0,z:n},{x:0,y:i,z:n},{x:0,y:i,z:0},{x:t,y:0,z:0,move:1},{x:t,y:0,z:n},{x:t,y:i,z:n},{x:t,y:i,z:0},{x:0,y:0,z:n,move:1},{x:t,y:0,z:n},{x:0,y:i,z:n,move:1},{x:t,y:i,z:n},{x:0,y:0,z:0,move:1}],e.prototype.init.call(this)}}),i.Cube=n}(this),function(t){var i=t.lego,e=i.Group,n={load:function(t,i){var e=this,n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){4==n.readyState&&200==n.status&&i(e.parse(n.response))},n.send()},parse:function(t){var i=[],n=t.match(/[\r\n](v\s[\S\s]+?)\send\s/g);n.forEach(function(t){var e=t.indexOf("surf ")>-1;if(t=t.replace(/cstype[\s\S]+end\s/,"").replace(/^\s/,"").replace(/v\s/g,"[").replace(/[\r\n]+/g,"],").replace(/[\s]/g,","),t="["+t.slice(0,-1)+"]",t=JSON.parse(t),e){var n=t[3];t[3]=t[2],t[2]=n}i.push(t)});for(var s=[],r=0,o=i.length;o>r;r++)for(var a=i[r],h=0,c=a.length;c>h;h++){var u={x:a[h][0],y:a[h][1],z:a[h][2]};s.push(u),0==h&&(u.move=1),h==c-1&&s.push({x:a[0][0],y:a[0][1],z:a[0][2]})}return s.push(s[0]),new e({points:s})}};i.DataParser=n}(this);